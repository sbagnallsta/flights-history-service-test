# GO CircleCI 1.0 configuration file

# sets the triggers for a specific branch
general:
  branches:
    only:
      - master

# sets the CircleCI virtual machine to use go and Docker services
machine:
  java:
    version: openjdk8
  services:
    - docker
  environment:
    # GOROOT is not set by default
    GOROOT: ""
    GOPATH: "${HOME}/flights-history-service-test"
    PATH: "${GOPATH}/bin:${PATH}"
    BUILD_PATH: "${GOPATH}/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}"

dependencies:
  override:
    - mkdir -p $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME
    - ln -fs $HOME/$CIRCLE_PROJECT_REPONAME $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
    - |
      echo 'export GOPATH=$GOPATH:$HOME/.go_project' >> ~/.circlerc

test:
  pre:
    - cp -r /flights-history-service/profiles  ~/.go_project/src/github.com/
    - cd $BUILD_PATH && go get -v -t -d ./...
  # override:
  #   - cd $BUILD_PATH && godep go test -v -race $(go list ./... | grep -v /vendor/)
